
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>memcached study - Weichien's studying note</title>
	<meta name="author" content="Weichien Hung">

	
	<meta name="description" content="I studied the memcached since yesterday. It&#8217;s a good cache implementation used by Twitter,Facebook..etc.
Because the official site doesn&#8217; &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Weichien's studying note" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><a class="myheader-avatar" href="/"><img src="/images/samuel.jpg"></a>
<div class="myheader-slogan">
<h1><a href="/">Weichien's studying note</a></h1>
<h2>Practice makes perfect</h2>
</div>
<nav id="main-nav"><ul class="main">
	<!-- <li><a href="/">Blog</a></li> -->
	<li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <!-- <li><a href="/blog/category">Category</a></li> -->
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a id="menu-btn" class="button">Menu</a>
		<div class="container"><ul class="main">
	<!-- <li><a href="/">Blog</a></li> -->
	<li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <!-- <li><a href="/blog/category">Category</a></li> -->
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:weichienhung.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		<a class="facebook" href="http://www.facebook.com/weichien.hung" title="Facebook">Facebook</a>
		
		
		<a class="google" href="https://plus.google.com/113676445086645352045?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/HungWeichien" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/weichienhung" title="GitHub">GitHub</a>
		
    
		
		
		
		
		<!-- 
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		 -->
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:weichienhung.github.io">
	</form>
</nav>

</header>
<!-- 	
		
	 -->
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Memcached Study</h2>
	<div class="entry-content"><p>I studied the memcached since yesterday. It&#8217;s a good cache implementation used by Twitter,Facebook..etc.
Because the official site doesn&#8217;t provide the rpm for download and i can&#8217;t get the latest version from yum.
I learn how to build it from source and also try the <a href="http://repcached.lab.klab.org/">repached</a>(for memcached replication but not official)</p>

<!-- more -->


<h2>how to install memcached from source</h2>

<p>You can refer to <a href="https://code.google.com/p/memcached/wiki/NewInstallFromSource">link</a>(i didn&#8217;t find this post until i solve the installation XD)</p>

<h3>install libevent dependency</h3>

<p>I try download the libevent source from website and build it. But i found <code>yum</code> is the easiest. Don&#8217;t worry if your libevent version is 1.4.x not 2.0.x.
memcached-1.4.15 can be build with libevent-1.4.x</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yum install libevent-devel
</span></code></pre></td></tr></table></div></figure>


<h3>download the memcached-1.x.x.tar from <a href="http://memcached.org/">memcached.org</a> and untar</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tar zxvf memcached-1.x.x.tar
</span></code></pre></td></tr></table></div></figure>


<h3>make it</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./configure --prefix<span class="o">=</span>/usr/local/memcached-1.4.x/
</span><span class='line'>
</span><span class='line'>make
</span><span class='line'>
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<p>you may fail in <code>configure</code> and show no libevent dependency. you should add <code>--with-libevent=/usr/local/libevent/</code>(your libevent library folder) in configure</p>

<h2>start memcached</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd</span> /usr/local/memcached-1.4.x/bin/
</span><span class='line'>
</span><span class='line'>./memcached -u nobody -p 11211 -P /usr/local/memcached-1.4.x/bin/mem.pid -d -v
</span></code></pre></td></tr></table></div></figure>


<h2>stop memcached</h2>

<p>find the process id from /usr/local/memcached-1.4.x/bin/mem.pid and kill it</p>

<h2>how to make memcached cluster</h2>

<p>Each memcached node is configured independently in the cluster. They don&#8217;t communicate or exchange data. It&#8217;s the client&#8217;s job to decide which
server  from the cluster. Clients may use the consistent-hash to choose a memcached node and write/read data.<br/>
Memcached make your application performance better but your application have to work correctly even the memcached servers crash.
Memcached is not the storage solution.</p>

<h2>install memcached with repcache</h2>

<p>I upload the related repache patch and memcached-1.4.4 source to Dropbox. You can download from it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>wget --no-check-certificate https://dl.dropboxusercontent.com/u/60216960/memcached-1.4.4.zip
</span></code></pre></td></tr></table></div></figure>


<h3>patch source before configure</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>patch -p1 -i repcached-2.2-1.4.4.patch
</span></code></pre></td></tr></table></div></figure>


<h3>make it</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./configure --enable-replication --prefix<span class="o">=</span>/usr/local/memcached-1.4.4-rep/
</span><span class='line'>
</span><span class='line'>make
</span><span class='line'>
</span><span class='line'>make install
</span></code></pre></td></tr></table></div></figure>


<h2>start memcached with repcache</h2>

<p>For example, we have two servers: server 1(192.168.0.103) and server 2(192.168.0.101)<br/>
In server 1</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./memcached -u nobody -v -p 11211 -X 11212
</span></code></pre></td></tr></table></div></figure>


<p>In server 2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./memcached -u nobody -v -p 11211 -x 192.168.0.103 -X 11212
</span></code></pre></td></tr></table></div></figure>


<h3>test the replication</h3>

<p>add key in server 1</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>telnet 192.168.0.103 11211
</span><span class='line'>add hello 0 0 2
</span><span class='line'>99
</span></code></pre></td></tr></table></div></figure>


<p>read in server 2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>telnet 192.168.0.101 11211
</span><span class='line'>get hello
</span></code></pre></td></tr></table></div></figure>

</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-08-07T21:27:00+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/linux/'>linux</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Weichien Hung

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $(document).ready(function(){
    $('.fancybox').fancybox();
  })
})(jQuery);
</script> 


<script type="text/javascript">
      var disqus_shortname = 'weichienhung';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://weichienhung.github.io/blog/2013/08/07/memcached-study/';
        var disqus_url = 'http://weichienhung.github.io/blog/2013/08/07/memcached-study/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>